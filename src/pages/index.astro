---
import { SignIn, SignOut } from "auth-astro/components";
import { PrismaClient } from "@prisma/client";
import { authOpts } from "./api/auth/[...astroauth]";
import Layout from "../layouts/Layout.astro";
import { getSession } from "auth-astro";

const session = await getSession(Astro.request, authOpts);

const prisma = new PrismaClient();
const sorteios = await prisma.sorteioGrupoTeste.findMany();
---

<Layout title="Roleta">
	<main>
		<a href="/sorteios/novo">Criar Sorteio</a>

		<p>Sorteios: {sorteios.length}</p>

		<ul>
			{sorteios.map((sorteio) => <li>{sorteio.nome}</li>)}
		</ul>

		{(session?.user == null) ? (
			<SignIn provider="github">
				Entrar
			</SignIn>
		) : (
			<>
				<p>Usu√°rio: {session.user.name}</p>

				<SignOut>
					Sair
				</SignOut>
			</>
		)}
	</main>
</Layout>
